flowchart TB
    subgraph INPUT["ğŸ“¥ INPUT - GEMINI EVALUATION"]
        IN1["Full Transcript<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Complete conversation text<br/>Example:<br/>User: 'I have 5 years of experience<br/>working with React and TypeScript...'<br/>AI: 'That's great! Can you tell me<br/>about a challenging project?'<br/>User: 'I worked on a project where...'"]
        
        IN2["Structured Q&A Pairs<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Turns = [<br/>  {<br/>    orderIndex: 1,<br/>    questionText: 'Tell me about yourself',<br/>    answerText: 'I have 5 years...',<br/>    questionCategory: 'BEHAVIORAL'<br/>  },<br/>  {<br/>    orderIndex: 2,<br/>    questionText: 'Why this role?',<br/>    answerText: 'I'm interested because...',<br/>    questionCategory: 'GENERAL'<br/>  },<br/>  ...<br/>]"]
    end
    
    subgraph PROMPT_BUILD["ğŸ“ BUILD ANALYSIS PROMPT"]
        P1["Combine Input Data<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ Full transcript<br/>â€¢ Structured Q&A turns<br/>â€¢ Format as text"]
        
        P2["Add Evaluation Instructions<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ 6 Evaluation Criteria<br/>â€¢ Scoring guidelines<br/>â€¢ Question type adjustments<br/>â€¢ Category definitions<br/>â€¢ Output format (JSON)"]
        
        P3["Final Prompt<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Complete prompt ready<br/>for Gemini API"]
    end
    
    subgraph CRITERIA["ğŸ“ 6 EVALUATION CRITERIA"]
        C1["1. LENGTH (Weight: 25%)<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Assess answer completeness<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Minimum words:<br/>â€¢ Junior: 18 words<br/>â€¢ Mid: 25 words<br/>â€¢ Senior: 35 words<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Good length:<br/>â€¢ Junior: 25-70 words<br/>â€¢ Mid: 40-90 words<br/>â€¢ Senior: 60-120 words<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Scoring:<br/>0 = No answer<br/>4 = Too short<br/>7 = Adequate<br/>8 = Optimal length"]
        
        C2["2. STRUCTURE (Weight: 20%)<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Evaluate organization & flow<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Look for STAR method:<br/>â€¢ Situation<br/>â€¢ Task<br/>â€¢ Action<br/>â€¢ Result<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Or structured approach:<br/>â€¢ Problem â†’ Approach â†’ Outcome<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Scoring:<br/>4 = Unstructured<br/>10 = Well-structured<br/>with STAR/clear narrative"]
        
        C3["3. EXAMPLES (Weight: 20%)<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Assess concrete evidence<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Look for:<br/>â€¢ Specific numbers: 10%, 1000 users<br/>â€¢ Metrics: KPI, latency, throughput<br/>â€¢ Time references: 6 months, 2 years<br/>â€¢ Revenue/impact: $1M, 50% increase<br/>â€¢ Explicit examples: 'for example'<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Scoring:<br/>4 = No examples<br/>10 = Clear examples<br/>with measurable impact"]
        
        C4["4. CONFIDENCE (Weight: 10%)<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Evaluate assertiveness<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Penalize filler words:<br/>â€¢ 'uh', 'um'<br/>â€¢ 'maybe', 'probably'<br/>â€¢ 'not sure', 'I think'<br/>â€¢ 'kind of', 'sort of'<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Scoring:<br/>4 = Very hesitant<br/>(â‰¥4 filler words)<br/>8 = Confident and decisive"]
        
        C5["5. KEYWORD MATCH (Weight: 15%)<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Assess role-related keywords<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Must-have keywords:<br/>â€¢ Weight Ã—3<br/>â€¢ Critical for role<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Nice-to-have keywords:<br/>â€¢ Weight Ã—1<br/>â€¢ Bonus points<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Scoring:<br/>0 = No keywords<br/>10 = Comprehensive<br/>keyword coverage"]
        
        C6["6. RELEVANCE (Weight: 10%)<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Evaluate direct relevance<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Compare question & answer:<br/>â€¢ Token/keyword matching<br/>â€¢ Topic alignment<br/>â€¢ Direct addressing<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Penalize off-topic:<br/>â€¢ Low relevance but long<br/>â†’ Max 5/10<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Scoring:<br/>0 = Completely irrelevant<br/>10 = Directly addresses question"]
    end
    
    subgraph QUESTION_TYPE["ğŸ¯ QUESTION TYPE ADJUSTMENTS"]
        Q1["TECHNICAL Questions<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Increase weights:<br/>â€¢ +keywordMatch (+8%)<br/>â€¢ +relevance (+5%)<br/>â€¢ +examples (+3%)<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Decrease weights:<br/>â€¢ -structure (-3%)"]
        
        Q2["BEHAVIORAL Questions<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Increase weights:<br/>â€¢ +structure (+8%)<br/>â€¢ +examples (+5%)<br/>â€¢ +confidence (+3%)<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Decrease weights:<br/>â€¢ -keywordMatch (-4%)"]
        
        Q3["GENERAL Questions<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Use default weights<br/>No adjustments"]
    end
    
    subgraph GEMINI_API["ğŸ§  GOOGLE GEMINI 2.5 FLASH"]
        G1["Call Gemini API<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Model: gemini-2.5-flash<br/>(with fallbacks to<br/>gemini-1.5-flash)<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Method: generateContent()<br/>Input: Analysis prompt<br/>Output: JSON response"]
        
        G2["Parse JSON Response<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Extract from response.text:<br/>â€¢ Remove markdown if any<br/>â€¢ Remove code blocks<br/>â€¢ Parse JSON string<br/>â€¢ Extract structured data"]
        
        G3["Validate with Zod Schema<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Validate structure:<br/>â€¢ overallScore: 0-100 int<br/>â€¢ recommendation: enum<br/>â€¢ summary: string<br/>â€¢ strengths: string[]<br/>â€¢ areasForImprovement: string[]<br/>â€¢ categoryScores: array<br/>â€¢ perQuestion: array"]
    end
    
    subgraph SCORING["ğŸ“Š SCORING CALCULATION"]
        S1["Per-Question Score<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>For each question:<br/>Calculate weighted sum:<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>score =<br/>(length Ã— 0.25) +<br/>(structure Ã— 0.20) +<br/>(examples Ã— 0.20) +<br/>(confidence Ã— 0.10) +<br/>(keywordMatch Ã— 0.15) +<br/>(relevance Ã— 0.10)<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Range: 0-10<br/>Adjust by question type"]
        
        S2["Overall Score<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Overall Score =<br/>(Average per-question score) Ã— 10<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Range: 0-100<br/>Integer value"]
        
        S3["Category Scores<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>5 Categories (0-10 each):<br/>1. Clarity<br/>2. Structure<br/>3. Depth & Evidence<br/>4. Relevance<br/>5. Keyword Match"]
    end
    
    subgraph RECOMMENDATION["ğŸ¯ RECOMMENDATION"]
        R1["Calculate Overall Score<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>From per-question scores"]
        
        R2{"Overall Score?"}
        
        R3["HIRE<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Score â‰¥ 80<br/>Excellent candidate<br/>Strong performance"]
        
        R4["CONSIDER<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Score 60-79<br/>Potential candidate<br/>Needs consideration"]
        
        R5["REJECT<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Score < 60<br/>Does not meet requirements<br/>Weak performance"]
    end
    
    subgraph OUTPUT["âœ… OUTPUT - STRUCTURED FEEDBACK"]
        OUT1["Interview Feedback Object<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>{<br/>  overallScore: 85,<br/>  recommendation: 'HIRE',<br/>  summary: 'Strong candidate with<br/>    clear communication and<br/>    relevant experience...',<br/>  strengths: [<br/>    'Clear communication',<br/>    'Strong technical knowledge',<br/>    'Good examples provided'<br/>  ],<br/>  areasForImprovement: [<br/>    'Could provide more metrics',<br/>    'Structure answers better'<br/>  ],<br/>  categoryScores: [<br/>    {name: 'Clarity', score: 9, comment: '...'},<br/>    {name: 'Structure', score: 8, comment: '...'},<br/>    {name: 'Depth & Evidence', score: 9, comment: '...'},<br/>    {name: 'Relevance', score: 8, comment: '...'},<br/>    {name: 'Keyword Match', score: 9, comment: '...'}<br/>  ],<br/>  perQuestion: [<br/>    {orderIndex: 1, score: 8, feedback: 'Clear answer with good structure...'},<br/>    {orderIndex: 2, score: 9, feedback: 'Excellent response with examples...'},<br/>    {orderIndex: 3, score: 8, feedback: 'Good technical knowledge...'},<br/>    {orderIndex: 4, score: 7, feedback: 'Could provide more details...'},<br/>    {orderIndex: 5, score: 9, feedback: 'Strong closing statement...'}<br/>  ]<br/>}"]
    end
    
    %% Input Flow
    IN1 --> P1
    IN2 --> P1
    
    %% Prompt Building
    P1 --> P2
    P2 --> P3
    
    %% Criteria to Prompt
    C1 --> P2
    C2 --> P2
    C3 --> P2
    C4 --> P2
    C5 --> P2
    C6 --> P2
    
    %% Question Type to Prompt
    Q1 --> P2
    Q2 --> P2
    Q3 --> P2
    
    %% Gemini API Flow
    P3 --> G1
    G1 --> G2
    G2 --> G3
    
    %% Scoring
    G3 --> S1
    S1 --> S2
    S1 --> S3
    
    %% Recommendation
    S2 --> R1
    R1 --> R2
    R2 -->|â‰¥80| R3 --> OUT1
    R2 -->|60-79| R4 --> OUT1
    R2 -->|<60| R5 --> OUT1
    
    S3 --> OUT1
    
    %% Styling
    classDef input fill:#e3f2fd,stroke:#0277bd,stroke-width:3px,color:#000
    classDef prompt fill:#fff3e0,stroke:#e65100,stroke-width:2px,color:#000
    classDef criteria fill:#e8f5e9,stroke:#1b5e20,stroke-width:2px,color:#000
    classDef question fill:#f1f8e9,stroke:#33691e,stroke-width:2px,color:#000
    classDef gemini fill:#e1bee7,stroke:#4a148c,stroke-width:3px,color:#000
    classDef scoring fill:#f3e5f5,stroke:#4a148c,stroke-width:2px,color:#000
    classDef recommendation fill:#ffebee,stroke:#c62828,stroke-width:2px,color:#000
    classDef output fill:#c8e6c9,stroke:#1b5e20,stroke-width:3px,color:#000
    classDef decision fill:#fff9c4,stroke:#f9a825,stroke-width:2px,color:#000
    
    class IN1,IN2,INPUT input
    class P1,P2,P3,PROMPT_BUILD prompt
    class C1,C2,C3,C4,C5,C6,CRITERIA criteria
    class Q1,Q2,Q3,QUESTION_TYPE question
    class G1,G2,G3,GEMINI_API gemini
    class S1,S2,S3,SCORING scoring
    class R1,R2,R3,R4,R5,RECOMMENDATION recommendation
    class OUT1,OUTPUT output
    class R2 decision

